{% embed '@Forumify/components/modal.html.twig' %}
    {% block modalOpenButton %}
        <button type="button" class="btn-link btn-icon" {{ stimulus_action('forumify/forumify-platform/modal', 'open') }}>
            <i class="ph ph-notebook" style="color:#1a3f5f;"></i>
        </button>
    {% endblock %}
    {% block modalContent %}
        <div class="card">
            <div class="card-title" style="background-color:#13233A;color:#ececec;">Property Notes & History</div>
            <div class="card-body">
                <div>
                    <div class="card-title">Property Notes</div>
                    <div class="card-body">{{ property.note }}</div>
                </div>
                <div class="mt-5">
                    <div class="card-title">Property History</div>
                    <div class="card-body">
                        {% if logs is empty%}
                            No History available for this property.
                        {% else %}
                            <table class="w-100">
                                <thead>
                                <tr>
                                    <th class="text-left">Date & Time</th>
                                    <th class="text-left">Action</th>
                                    <th class="text-left">Performed By</th>
                                    <th class="text-left">Changes</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for log in logs %}
                                    <tr>
                                        <td>{{ log.createdAt|date('d/m/Y H:i') }}</td>
                                        <td>
                                            <span>{{ log.action.label }}</span>
                                        </td>
                                        <td>{{ log.performedBy.name }}</td>
                                        <td>
                                            {% if log.changes %}
                                                <details>
                                                    <summary style="cursor: pointer;">View changes</summary>
                                                    <ul style="margin-top: 10px;">
                                                        {% for field, change in log.changes %}
                                                            {% if change.old is defined %}
                                                                <li>
                                                                    <strong>{{ field|title }}:</strong>
                                                                    <span style="text-decoration: line-through; color: #999;">
                                                                    {{ change.old ?? 'empty' }}
                                                                </span>
                                                                    <i class="ph ph-arrow-right"></i>
                                                                    <span style="color: #28a745;">
                                                                    {{ change.new ?? 'empty' }}
                                                                </span>
                                                                </li>
                                                            {% else %}
                                                                <li>
                                                                    <span class="text-bold">{{ field|title }}:</span> {{ change }}
                                                                </li>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </details>
                                            {% else %}
                                                No changes recorded
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    {% endblock %}
{% endembed %}